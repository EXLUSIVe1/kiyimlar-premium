<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel | Exclusive Premium House</title>
  <link rel="icon" type="image/png" href="image/premiumm.jpg" />
  <style>
    body { background:#111; color:#fff; font-family:'Poppins',sans-serif; text-align:center; padding:40px; margin:0; }
    header { background:#000; padding:15px 0; }
    .container { width:90%; margin:auto; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
    .logo { font-size:24px; font-weight:bold; color:#fff; }
    .logo span { color:gold; }
    .lang-switcher { display:flex; gap:6px; }
    .lang-switcher button {
      margin-left:5px; padding:8px 14px; border:2px solid gold;
      border-radius:8px; cursor:pointer; font-weight:bold;
      background:transparent; color:white; transition:all 0.3s ease;
    }
    .lang-switcher button:hover { background:gold; color:#111; transform:scale(1.05); }
    .lang-switcher button.active { background-color:gold; color:#111; }

    .login-box, .admin-panel {
      max-width:900px; margin:40px auto; background:#1b1b1b;
      padding:30px; border-radius:15px; box-shadow:0 0 15px rgba(255,215,0,0.3);
    }
    input, textarea {
      width:100%; padding:10px; margin:8px 0; border:none;
      border-radius:8px; outline:none;
    }
    input[type="file"] { background:none; color:#ddd; }
    button {
      background:gold; color:#111; font-weight:bold; border:none;
      padding:10px 20px; border-radius:8px; cursor:pointer; transition:.3s; margin:5px;
    }
    button:hover { background:#ffcc00; }
    h2 { color:gold; margin-bottom:20px; }
    .products-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:20px; margin-top:20px; }
    @media (max-width:768px){ .products-grid { grid-template-columns:1fr; } }
    .product-card {
      background:#222; padding:15px; border-radius:10px; text-align:center;
      box-shadow:0 0 10px rgba(255,215,0,0.3);
    }
    .product-card img { max-width:100%; border-radius:8px; height:150px; object-fit:cover; margin-bottom:10px; }
    .product-card input { width:90%; border-radius:5px; border:none; padding:5px; text-align:center; margin:5px 0; }
    .product-card button { width:45%; margin:5px 2%; }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="container">
      <div class="logo">Exclusive <span>Premium House</span></div>
      
      <div class="lang-switcher">
        <button data-lang="uz" class="active">UZ</button>
        <button data-lang="ru">RU</button>
        <button data-lang="en">EN</button>
      </div>
    </div>
  </header>

  <!-- LOGIN -->
  <div class="login-box" id="loginBox">
    <h2 data-key="loginTitle">Admin panelga kirish</h2>
    <input type="password" id="adminPassword" placeholder="Parolni kiriting">
    <button onclick="checkPassword()" data-key="loginBtn">Kirish</button>
  </div>

  <!-- ADMIN PANEL -->
  <div class="admin-panel" id="adminPanel" style="display:none;">
    <button onclick="goHome()" data-key="homeBtn">üè† Bosh sahifaga qaytish</button>

    <h2 data-key="addTitle">Mahsulot qo‚Äòshish</h2>
    <input type="text" id="productName" placeholder="Mahsulot nomi">
    <textarea id="productDesc" placeholder="Mahsulot tavsifi"></textarea>
    <input type="number" id="productPrice" placeholder="Narx (so‚Äòmda)">
    <input type="file" id="productImage" accept="image/*" required />
    <div id="imagePreview" style="margin:10px 0;"></div>
    <button id="addProduct" data-key="addBtn">Qo‚Äòshish</button>

    <hr style="margin:30px 0; border-color:gold;">
    <h2 data-key="productsTitle">Mahsulotlar</h2>
    <div class="products-grid" id="productsGrid">
      <p data-key="loading">Mahsulotlar yuklanmoqda...</p>
    </div>

    <hr style="margin:30px 0; border-color:gold;">
    <h2 data-key="ordersTitle">Buyurtmalar</h2>
    <table id="ordersTable" style="width:100%; border-collapse:collapse; color:#fff;">
      <tr>
        <th>ID</th>
        <th data-key="customer">Mijoz</th>
        <th data-key="items">Mahsulotlar</th>
        <th data-key="total">Total</th>
        <th data-key="actions">Amallar</th>
      </tr>
    </table>
  </div>

  <!-- FIREBASE SCRIPT -->
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA8pO6GBi5MeeycsKIgZUOYvAUM639kKvI",
    authDomain: "premiumuz-9f03d.firebaseapp.com",
    databaseURL: "https://premiumuz-9f03d-default-rtdb.firebaseio.com",
    projectId: "premiumuz-9f03d",
    storageBucket: "premiumuz-9f03d.firebasestorage.app",
    messagingSenderId: "874271730419",
    appId: "1:874271730419:web:74f35f5465a8ff4771a586",
    measurementId: "G-T0DE6KSDGH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const ADMIN_PASSWORD = "aBRORbek1717";

  const productsGrid = document.getElementById("productsGrid");
  const productsRef = ref(db, "products");

  window.checkPassword = ()=> {
    const pass=document.getElementById("adminPassword").value;
    if(pass===ADMIN_PASSWORD){
      document.getElementById("loginBox").style.display="none";
      document.getElementById("adminPanel").style.display="block";
    } else alert(currentLang === "ru" ? "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!" : currentLang === "en" ? "‚ùå Incorrect password!" : "‚ùå Noto‚Äòg‚Äòri parol!");
  };

  window.goHome=()=>{ window.location.href="index.html"; };

  document.getElementById("productImage").addEventListener("input",(e)=>{
    const url=e.target.value;
    const preview=document.getElementById("imagePreview");
    preview.innerHTML=url ? `<img src="${url}" style="max-width:150px; border-radius:8px;">` : "";
  });

  document.getElementById("addProduct").addEventListener("click", ()=>{
    const name=document.getElementById("productName").value.trim();
    const desc=document.getElementById("productDesc").value.trim();
    const price=document.getElementById("productPrice").value.trim();
    const image=document.getElementById("productImage").value.trim();
    if(!name || !price || !image){ alert("‚ö†Ô∏è Iltimos, barcha maydonlarni to‚Äòldiring!"); return; }
    push(productsRef,{name,desc,price,image,date:new Date().toLocaleString()})
      .then(()=>{ 
        alert("‚úÖ Mahsulot qo‚Äòshildi!"); 
        document.getElementById("productName").value="";
        document.getElementById("productDesc").value="";
        document.getElementById("productPrice").value="";
        document.getElementById("productImage").value="";
        document.getElementById("imagePreview").innerHTML="";
      });
  });

  onValue(productsRef,(snapshot)=>{
    productsGrid.innerHTML="";
    const products=snapshot.val();
    if(products){
      Object.keys(products).forEach(id=>{
        const p=products[id];
        const card=document.createElement("div");
        card.classList.add("product-card");
        card.innerHTML=`
          <img src="${p.image}">
          <input value="${p.name}" id="name-${id}">
          <input value="${p.desc}" id="desc-${id}">
          <input value="${p.price}" id="price-${id}">
          <div>
            <button onclick="updateProduct('${id}')">${translations[currentLang].edit}</button>
            <button onclick="deleteProduct('${id}')">${translations[currentLang].delete}</button>
          </div>`;
        productsGrid.appendChild(card);
      });
    } else productsGrid.innerHTML=`<p>${translations[currentLang].noProducts}</p>`;
  });

  window.updateProduct=(id)=>{
    const name=document.getElementById(`name-${id}`).value;
    const desc=document.getElementById(`desc-${id}`).value;
    const price=document.getElementById(`price-${id}`).value;
    update(ref(db,"products/"+id),{name,desc,price})
      .then(()=>alert("‚úÖ Mahsulot yangilandi"));
  };

  window.deleteProduct=(id)=>{
    if(confirm(translations[currentLang].confirmDelete))
      remove(ref(db,"products/"+id))
        .then(()=>alert("‚úÖ Mahsulot o‚Äòchirildi"));
  };

  const ordersRef = ref(db,"orders/");
  const ordersTable=document.getElementById("ordersTable");
  onValue(ordersRef,(snapshot)=>{
    ordersTable.innerHTML=`
      <tr>
        <th>ID</th>
        <th>${translations[currentLang].customer}</th>
        <th>${translations[currentLang].items}</th>
        <th>${translations[currentLang].total}</th>
        <th>${translations[currentLang].actions}</th>
      </tr>`;
    const orders=snapshot.val();
    if(orders){
      Object.keys(orders).forEach(id=>{
        const o=orders[id];
        const items=o.items.map(i=>`${i.name} (${Number(i.price).toLocaleString()} so'm)`).join(", ");
        const row=document.createElement("tr");
        row.innerHTML=`
          <td>${id}</td>
          <td>${o.name} / ${o.phone}</td>
          <td>${items}</td>
          <td>${o.total} so'm</td>
          <td><button onclick="deleteOrder('${id}')">${translations[currentLang].delete}</button></td>`;
        ordersTable.appendChild(row);
      });
    }
  });
  window.deleteOrder=(id)=>{
    if(confirm(translations[currentLang].confirmDelete))
      remove(ref(db,"orders/"+id))
        .then(()=>alert("‚úÖ Buyurtma o‚Äòchirildi"));
  };

  // === TIL TARJIMASI ===
  const translations = {
    uz: { loginTitle:"Admin panelga kirish", loginBtn:"Kirish", homeBtn:"üè† Bosh sahifaga qaytish", addTitle:"Mahsulot qo‚Äòshish", addBtn:"Qo‚Äòshish", productsTitle:"Mahsulotlar", ordersTitle:"Buyurtmalar", loading:"Mahsulotlar yuklanmoqda...", customer:"Mijoz", items:"Mahsulotlar", total:"Jami", actions:"Amallar", edit:"Tahrirlash", delete:"O‚Äòchirish", confirmDelete:"Bu elementni o‚Äòchirilsinmi?", noProducts:"Hozircha mahsulotlar yo‚Äòq." },
    ru: { loginTitle:"–í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞", loginBtn:"–í–æ–π—Ç–∏", homeBtn:"üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é", addTitle:"–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç", addBtn:"–î–æ–±–∞–≤–∏—Ç—å", productsTitle:"–ü—Ä–æ–¥—É–∫—Ç—ã", ordersTitle:"–ó–∞–∫–∞–∑—ã", loading:"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤...", customer:"–ö–ª–∏–µ–Ω—Ç", items:"–¢–æ–≤–∞—Ä—ã", total:"–°—É–º–º–∞", actions:"–î–µ–π—Å—Ç–≤–∏—è", edit:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", delete:"–£–¥–∞–ª–∏—Ç—å", confirmDelete:"–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç?", noProducts:"–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤." },
    en: { loginTitle:"Admin Panel Login", loginBtn:"Login", homeBtn:"üè† Back to Home", addTitle:"Add Product", addBtn:"Add", productsTitle:"Products", ordersTitle:"Orders", loading:"Loading products...", customer:"Customer", items:"Items", total:"Total", actions:"Actions", edit:"Edit", delete:"Delete", confirmDelete:"Delete this item?", noProducts:"No products yet." }
  };

  let currentLang = localStorage.getItem("siteLang") || "uz";

  function applyLanguage(lang) {
    currentLang = lang;
    document.querySelectorAll("[data-key]").forEach(el=>{
      const key=el.getAttribute("data-key");
      if(translations[lang][key]) el.textContent=translations[lang][key];
    });
    document.querySelectorAll(".lang-switcher button").forEach(btn=>btn.classList.remove("active"));
    document.querySelector(`.lang-switcher button[data-lang='${lang}']`).classList.add("active");
    localStorage.setItem("siteLang", lang);
  }

  applyLanguage(currentLang);

  document.querySelectorAll(".lang-switcher button").forEach(btn=>{
    btn.addEventListener("click",()=>{
      applyLanguage(btn.getAttribute("data-lang"));
      location.reload();
    });
  });
  </script>
</body>
</html>
